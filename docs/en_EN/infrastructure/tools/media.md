# Media Tools

> [Tools](README.md) / Media

Image processing utilities for web development: format conversion and QR code generation.

## Image Converter (`convert_to_webp.py`)

Converts PNG/JPG images to WebP format with multiple operation modes.

### Run

```bash
# CLI with subcommands:
python tools/media/convert_to_webp.py convert src/backend_django/static/img --quality 80
python tools/media/convert_to_webp.py resize src/backend_django/static/img --max-width 1920
python tools/media/convert_to_webp.py optimize src/backend_django/static/img --quality 75
python tools/media/convert_to_webp.py restore src/backend_django/static/img
python tools/media/convert_to_webp.py info src/backend_django/static/img

# Interactive (no arguments):
python tools/media/convert_to_webp.py
```

### Modes

| Mode | Description |
|:-----|:------------|
| `convert` | PNG/JPG → WebP. Originals moved to `_source/` |
| `optimize` | Re-compress existing WebP files with new quality |
| `resize` | Resize to max width/height + convert to WebP |
| `restore` | Move originals back from `_source/`, delete WebP versions |
| `info` | Show table: filename, format, file size, dimensions |

### Options

- `--quality` (1-100, default 80) — WebP compression quality
- `--max-width` (default 1920) — max width for resize mode
- `--max-height` (default 1080) — max height for resize mode

### How `_source/` Works

When converting, original files are moved to a `_source/` subdirectory (preserving folder structure). This allows safe rollback via `restore` mode. The `_source/` folder is excluded from scanning to avoid re-processing.

---

## QR Code Generator (`qr_generator.py`)

Tkinter GUI for creating styled QR codes with project branding.

### Run

```bash
python tools/media/qr_generator.py
```

### GUI Features

- **Data field** — URL or text to encode
- **Foreground/Background colors** — color picker dialogs
- **Transparent background** — checkbox, renders with alpha channel
- **Module styles** — Square, Rounded, Circle, Dots
- **Error correction** — L (7%), M (15%), Q (25%), H (30%)
- **Size slider** — 100 to 2000 pixels
- **Logo embedding** — file picker, centered with white circle mask
- **Preview** — live preview with checkerboard for transparency
- **Save** — PNG or WebP export

### Export Style Class

The key feature: **Export Style** button generates `tools/media/qr_style.py` — a singleton class with your current style settings baked in.

### Dependencies

- `qrcode-styled` — styled QR generation (rounded modules, colors)
- `Pillow` — image processing
- `tkinter` — GUI (built into Python)

---

## QR Style Class (`qr_style.py`)

Generated by the QR Generator. Contains your project's QR code style as a singleton.

### Usage

```python
from tools.media.qr_style import qr_style

# Generate PIL Image with project style
img = qr_style.generate("https://example.com")
img.save("qr.png")

# Custom size
img = qr_style.generate("https://example.com", size=200)

# With logo
img = qr_style.generate("https://example.com", logo="logo.png")

# Get bytes (for bot/API responses)
data = qr_style.to_bytes("https://t.me/mybot", fmt="webp")
```

### What's Fixed in the Class

The exported class locks these settings from the GUI:
- Foreground color
- Background color (or transparent)
- Module style (Square/Rounded/Circle/Dots)
- Error correction level
- Default size

### What Can Be Overridden Per-Call

- `size` — output dimensions
- `logo` — logo image path
- `fmt` — output format ("png" or "webp") for `to_bytes()`

### Portability

The class is self-contained (depends only on `qrcode-styled` + `Pillow`). Copy it to:
- `src/telegram_bot/utils/qr_style.py` — for bot QR generation
- `src/backend_django/utils/qr_style.py` — for backend QR generation
