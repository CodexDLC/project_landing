# ğŸ³ Docker Architecture

> `docs/en_EN/infrastructure/devops/` Â· [README](README.md) â†’ Docker

---

## Containers

The project uses modular Docker containers generated by the installer based on your module selection.

### Possible Services

| Service | Image | Port | Condition |
|:---|:---|:---|:---|
| `backend` | Custom (FastAPI) | 8000 | If FastAPI selected |
| `bot` | Custom (aiogram) | â€” | If Bot selected |
| `worker` | Custom (ARQ) | â€” | If Bot selected |
| `redis` | redis:7-alpine | 6379 | If Bot selected |
| `postgres` | postgres:16-alpine | 5432 | If FastAPI selected |
| `nginx` | nginx:alpine / Custom | 80, 443 | If any backend |

### Example: FastAPI + Bot (full stack)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    nginx                     â”‚
â”‚              :80 / :443 (SSL)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ proxy_pass
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      backend (FastAPI)    â”‚  â”‚  bot (aiogramâ”‚
â”‚          :8000            â”‚  â”‚    polling)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚   postgres    â”‚              â”‚    redis    â”‚
â”‚    :5432      â”‚              â”‚   :6379     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                               â”‚   worker    â”‚
                               â”‚   (ARQ)     â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Files

```
deploy/
â”œâ”€â”€ fastapi/
â”‚   â””â”€â”€ Dockerfile         # Multi-stage: builder â†’ runtime
â”œâ”€â”€ bot/
â”‚   â””â”€â”€ Dockerfile         # Multi-stage: builder â†’ runtime
â”œâ”€â”€ worker/
â”‚   â””â”€â”€ Dockerfile         # Same as bot, different CMD
â”œâ”€â”€ nginx/
â”‚   â”œâ”€â”€ Dockerfile         # Production nginx with configs
â”‚   â”œâ”€â”€ nginx-main.conf    # Main config (upstream, gzip, rate limiting)
â”‚   â”œâ”€â”€ site.conf          # Production (SSL, certbot, security headers)
â”‚   â””â”€â”€ site-local.conf    # Development (port 80, no SSL)
â”œâ”€â”€ docker-compose.yml     # Development
â””â”€â”€ docker-compose.prod.yml # Production (images from GHCR)
```

## Usage

### Development
```bash
cd deploy
docker compose up -d
docker compose logs -f
```

### Production
Production deployment is automated via CD Release workflow.
Images are built and pushed to GitHub Container Registry (GHCR).

## Environment Variables

All services read from `.env` file. See [github-secrets.md](github-secrets.md) for variable reference.
